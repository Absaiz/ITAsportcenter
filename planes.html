<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="imagen/logoico.png">
    <link rel="icon" type="image/png" href="imagen/logoico.png">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITA | Tarifas</title>
 
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    
    <script>
        const v = Date.now();
        function cargarCSS(src) {
            const l = document.createElement("link"); l.rel = "stylesheet"; l.href = src + '?v=' + v; document.head.appendChild(l);
        }
        function cargarJS(src) {
            const s = document.createElement('script'); s.type = 'module'; s.src = src + '?v=' + v; document.head.appendChild(s);
        }
        cargarCSS('style.css');
        cargarJS('layout.js');
    </script>

    <style>
        .plans-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 40px; }
        
        .plan-card { 
            background: #1a1a1a; border: 1px solid #333; border-radius: 10px; padding: 25px; 
            display: flex; flex-direction: column; transition: 0.3s;
            border-top: 5px solid var(--accent-pink);
        }
        .plan-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

        .plan-header { font-family: 'Oswald'; font-size: 1.8rem; color: white; margin-bottom: 10px; text-align: center; }
        .plan-desc { color: #888; font-size: 0.9rem; text-align: center; margin-bottom: 20px; font-style: italic; min-height: 40px; }

        /* TABLA DE PRECIOS */
        .price-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .price-table td { padding: 8px 0; border-bottom: 1px solid #333; color: #ccc; font-size: 0.9rem; }
        .price-table td:last-child { text-align: right; font-weight: bold; color: white; font-size: 1.1rem; }
        .price-table tr:last-child td { border-bottom: none; }

        .btn-plan { 
            margin-top: auto; display: block; text-align: center; padding: 12px; 
            background: transparent; border: 1px solid var(--accent-pink); color: white; 
            text-decoration: none; border-radius: 5px; font-weight: bold; transition: 0.3s; 
        }
        .btn-plan:hover { background: var(--accent-pink); }
    </style>
</head>
<body>
 
    <section class="container">
        <h2 class="section-title">TARIFAS Y PLANES</h2>
        <p style="text-align:center; color:#888;">Entrena a tu ritmo con nuestras opciones flexibles.</p>

        <div class="plans-grid" id="gridPlanes">
            <p style="text-align:center; width:100%">Cargando tarifas actualizadas...</p>
        </div>
    </section>

    <script type="module">
        import { db } from "./firebase-config.js";
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        async function cargarTarifas() {
            try {
                // Usamos la nueva colección 'tarifas_v2'
                const docRef = doc(db, "contenidos_web", "tarifas_v2");
                const docSnap = await getDoc(docRef);

                const container = document.getElementById('gridPlanes');

                if (docSnap.exists()) {
                    const d = docSnap.data();
                    let html = "";

                    // Recorremos los 6 planes
                    for(let i=1; i<=6; i++) {
                        // Solo mostramos el plan si tiene nombre (para no mostrar tarjetas vacías)
                        if(d[`p${i}_nom`]) {
                            html += `
                                <div class="plan-card">
                                    <h3 class="plan-header">${d[`p${i}_nom`]}</h3>
                                    <div class="plan-desc">${d[`p${i}_desc`] || ""}</div>
                                    
                                    <table class="price-table">
                                        <tr>
                                            <td>Clase Suelta</td>
                                            <td>${d[`p${i}_suelta`] || "-"}€</td>
                                        </tr>
                                        <tr>
                                            <td>Trimestral</td>
                                            <td>${d[`p${i}_trim`] || "-"}€</td>
                                        </tr>
                                        <tr>
                                            <td>Semestral</td>
                                            <td>${d[`p${i}_sem`] || "-"}€</td>
                                        </tr>
                                        <tr>
                                            <td>Anual</td>
                                            <td>${d[`p${i}_anual`] || "-"}€</td>
                                        </tr>
                                    </table>

                                    <a href="contacto.html" class="btn-plan">SOLICITAR INFO</a>
                                </div>
                            `;
                        }
                    }
                    container.innerHTML = html;
                } else {
                    container.innerHTML = "<p>No hay tarifas disponibles actualmente.</p>";
                }

            } catch (error) {
                console.error("Error cargando tarifas:", error);
                document.getElementById('gridPlanes').innerHTML = "<p>Error cargando datos.</p>";
            }
        }

        cargarTarifas();
    </script>

</body>
</html>